<!DOCTYPE html>
<html lang="en">
<!--<meta http-equiv="content-type" content="text/html;charset=UTF-8" />--><!-- /Added by HTTrack -->
<head>
  
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Capitol Money Pay Login</title>
    <meta content="" name="description" />
    <meta content="" name="author" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" type="image/x-icon" />
    <!-- For iPhone -->
    <link rel="apple-touch-icon-precomposed" href="../assets/images/apple-touch-icon-57-precomposed.png">
    <!-- For iPhone 4 Retina display -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/images/apple-touch-icon-114-precomposed.png">
    <!-- For iPad -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/images/apple-touch-icon-72-precomposed.png">
    <!-- For iPad Retina display -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/images/apple-touch-icon-144-precomposed.png">

    <!-- CORE CSS FRAMEWORK - START -->
    <link href="../assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/plugins/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/fonts/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="../assets/css/animate.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/plugins/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" type="text/css" />
    <!-- CORE CSS FRAMEWORK - END -->

    <!-- HEADER SCRIPTS INCLUDED ON THIS PAGE - START -->

    <!-- HEADER SCRIPTS INCLUDED ON THIS PAGE - END -->

    <!-- CORE CSS TEMPLATE - START -->
    <link href="../assets/css/style.css" rel="stylesheet" type="text/css" />
    <link href="../assets/css/responsive.css" rel="stylesheet" type="text/css" />
    <!-- CORE CSS TEMPLATE - END -->

</head>
<!-- END HEAD -->

<!-- BEGIN BODY -->

<body class=" login_page " style="background:url('image/bitcoin-futures-stockmarket.gif')">
    <div class="container">
        <div class="row">
            <div class=" mt-90 col-lg-8 col-lg-offset-2">
                <div class="row">
                    <div class="login-wrapper crypto">
                        
                        <div class="col-lg-10 col-sm-12 col-lg-offset-1">
                            <div id="login" class="login loginpage mt-0 no-pl no-pr pt30 pb30">    
                                <div class="box login" style="background-color: #16a8b100!important;">
                                    <!-- Loading State -->
                                    <div class="content-body" id="ContentLoading" style="padding-top:30px;background-color:#1080881f;">
										<div class="text-center alert alert-info" style="color:black;background: #17a2b8;border-radius: 10%;line-height: 2;font-weight: bold;">
											<h3><i class="fa fa-spinner fa-spin"></i> Verifying Your Account...</h3>
											<p style="font-size:15px;color:black;">Please wait while we verify your email address</p>
										</div>
                                    </div>
                                    
                                    <!-- Success State -->
                                    <div class="content-body" id="Content0" style="padding-top:30px;background-color:#1080881f;display:none;">
										<div class="text-center alert alert-success" style="color:black;background: #95f403;border-radius: 10%;line-height: 2;font-weight: bold;">
											<h3><i class="fa fa-check-circle"></i> Email Verification Successful!</h3>
											<p style="font-size:15px;color:black;">
												Your account has been successfully verified!<br/>
												Account details have been sent to your email.<br/>
												<span id="autoLoginMessage">Automatically logging you in...</span>
											</p>
											<div style="margin-top: 20px;">
												<div id="autoLoginProgress" style="margin-bottom: 15px;">
													<i class="fa fa-spinner fa-spin"></i> Redirecting to your dashboard...
												</div>
												<a href="nz-login.html" class="btn btn-primary" style="background: #28a745; border: none; padding: 10px 30px; border-radius: 5px; color: white; text-decoration: none; font-size: 16px; display: none;">
													<i class="fa fa-sign-in"></i> Manual Login
												</a>
											</div>
										</div>
                                    </div>
                                    
                                    <!-- Already Verified State -->
									<div class="content-body" id="Content1" style="padding-top:30px;background-color:#1080881f;display:none;">
										<div class="text-center alert alert-warning" style="color:black;border-radius: 10%;line-height: 2;font-weight: bold;">
											<h3><i class="fa fa-info-circle"></i> Your Account Already Verified</h3>
											<p style="font-size:15px;color:black;">
												Please Check Your Email For Account Details
											</p>
										</div>
                                    </div>
                                    
                                    <!-- Not Found/Expired State -->
									<div class="content-body" id="Content2" style="padding-top:30px;background-color:#1080881f;display:none;">
										<div class="text-center alert alert-danger" style="color:black;border-radius: 10%;line-height: 2;font-weight: bold;">
											<h3><i class="fa fa-exclamation-triangle"></i> Verification Link Expired</h3>
											<p style="font-size:15px;color:black;">
												Please Contact Support For Assistance
											</p>
										</div>
                                    </div>
                                    
                                    <!-- Error State -->
									<div class="content-body" id="ContentError" style="padding-top:30px;background-color:#1080881f;display:none;">
										<div class="text-center alert alert-danger" style="color:black;border-radius: 10%;line-height: 2;font-weight: bold;">
											<h3><i class="fa fa-times-circle"></i> Verification Failed</h3>
											<p style="font-size:15px;color:black;">
												An error occurred during verification. Please try again or contact support.
											</p>
										</div>
                                    </div>
									
								
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MAIN CONTENT AREA ENDS -->
    <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->

    <!-- CORE JS FRAMEWORK - START -->
    <script src="../assets/js/jquery-1.11.2.min.js"></script>
    <script>
		console.log('Starting verification process...');
		let losdf = location.href;
		console.log('Full URL:', losdf);
		
		// Parse the URL properly for format: #uID:U1VNT04wMQ==
		let hashPart = location.hash; // Gets #uID:U1VNT04wMQ==
		console.log('Hash part:', hashPart);
		
		let dfgd = '';
		if(hashPart && hashPart.includes('uID:')) {
			// Extract the base64 part after uID:
			let base64Part = hashPart.split('uID:')[1];
			console.log('Base64 part:', base64Part);
			
			try {
				dfgd = atob(base64Part);
				console.log('Decoded user ID:', dfgd);
			} catch(e) {
				console.error('Error decoding base64:', e);
				dfgd = '';
			}
		}
		
		if(dfgd != '' && dfgd != null) {
			console.log('Sending verification request for user:', dfgd);
			
			// Keep loading visible during AJAX request
			$("#ContentLoading").show();
			
			$.ajax({
				method: "POST",
				url: "viewdata/verify_id.php",
				data: {Usfd: dfgd},
				timeout: 30000,
				beforeSend: function() {
					console.log('Sending verification request...');
					// Show loading state
					$("#ContentLoading").show();
				}
			}).done(function(rer) {
				console.log('Verification response received:', rer);
				console.log('Response type:', typeof rer);
				
				// Hide loading
				$("#ContentLoading").hide();
				
				// Check if response contains HTML error (server error)
				if(typeof rer === 'string' && (rer.includes('<b>Fatal error</b>') || rer.includes('error') || rer.includes('Warning'))) {
					console.error('Server returned error:', rer);
					$("#ContentError").show();
					return;
				}
				
				// Function to handle auto-login failure
				function handleAutoLoginFailure() {
					$("#autoLoginMessage").text("Please login manually to access your account.");
					$("#autoLoginProgress").hide();
					$("#Content0").find('.btn').show();
				}
				
				// Handle different verification response codes
				if(rer == 0) {
					console.log('First-time verification successful - showing success message and auto-login');
					
					// Show success message
					$("#Content0").show();
					
					// Auto-login and redirect after 3 seconds
					setTimeout(function() {
						console.log('Starting auto-login process...');
						
						// Update message
						$("#autoLoginMessage").text("Processing automatic login...");
						
						// Perform auto-login via AJAX
						$.ajax({
							method: "POST",
							url: "viewdata/auto_login.php",
							data: {userId: dfgd},
							dataType: 'json',
							timeout: 10000
						}).done(function(loginResponse) {
							console.log('Auto-login response:', loginResponse);
							
							if(loginResponse && loginResponse.sts == 'success') {
								console.log('Auto-login successful, redirecting to dashboard...');
								
								// Update message
								$("#autoLoginMessage").text("Login successful! Redirecting...");
								$("#autoLoginProgress").html('<i class="fa fa-check"></i> ' + loginResponse.mess);
								
								// Redirect to member dashboard after a brief delay
								setTimeout(function() {
									window.location.href = 'https://capitolmoneypay.com' + loginResponse.url;
								}, 1500);
							} else {
								console.log('Auto-login failed, showing manual login button');
								handleAutoLoginFailure();
							}
						}).fail(function(xhr, status, error) {
							console.error('Auto-login request failed:', status, error);
							
							// Try to parse response as text for backward compatibility
							try {
								let textResponse = xhr.responseText;
								if(textResponse && textResponse.trim() == 'success') {
									console.log('Auto-login successful (text response), redirecting...');
									$("#autoLoginMessage").text("Login successful! Redirecting...");
									$("#autoLoginProgress").html('<i class="fa fa-check"></i> Redirecting to your dashboard...');
									
									setTimeout(function() {
										window.location.href = 'https://capitolmoneypay.com/member/index.php';
									}, 1500);
									return;
								}
							} catch(e) {
								console.error('Error parsing response:', e);
							}
							
							console.error('Auto-login request failed, showing manual login button');
							handleAutoLoginFailure();
						});
					}, 3000); // Wait 3 seconds before auto-login
					
				} else if(rer == 1) {
					console.log('Account already verified - showing already verified message');
					$("#Content1").show();
				} else if(rer == 2) {
					console.log('Verification failed - showing error message');
					$("#Content2").show();
				} else {
					console.log('Unknown response code:', rer);
					$("#ContentError").show();
				}
				
				// Add a small delay to ensure the message is visible
				setTimeout(function() {
					console.log('Verification process completed with result:', rer);
				}, 100);
			}).fail(function(xhr, status, error) {
				console.error('Verification request failed:');
				console.error('Status:', status);
				console.error('Error:', error);
				console.error('Response:', xhr.responseText);
				
				// Hide loading and show error
				$("#ContentLoading").hide();
				$("#ContentError").show();
			});
		} else {
			console.error('No valid user ID found in URL');
			$("#ContentLoading").hide();
			$("#ContentError").show();
		}
	</script>
	<script src="../assets/js/jquery.easing.min.js"></script>
    <script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/plugins/pace/pace.min.js"></script>
    <script src="../assets/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../assets/plugins/viewport/viewportchecker.js"></script>
    <script>
        window.jQuery || document.write('<script src="../assets/js/jquery-1.11.2.min.js"><\/script>');
    </script>
	
    <!-- CORE JS FRAMEWORK - END -->

    <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - START -->

    <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - END -->

    <!-- CORE TEMPLATE JS - START -->
    <!-- Scripts.js removed to prevent Swiper error on verification page -->
	<script src="/login/vendor/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="/login/vendor/jquery-validation/dist/additional-methods.min.js"></script>
</body>
</html>